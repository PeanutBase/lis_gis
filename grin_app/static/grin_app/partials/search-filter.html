<div id="tour-start" style="margin-top: 0.5rem;"></div>

<button id="search-btn"
	type="button"
	class="btn btn-sm btn-default"
	ng-if="! model.searchOptions"
	ng-click="model.searchOptions = ! model.searchOptions ; model.autofocusField = 'taxonFilter';">
  <span class="glyphicon glyphicon-search" aria-hidden="true"></span>  
  Search
</button>

<span id="current-search-filters">
  <!-- make a removable badge for each current search filter  -->

   <span ng-if="accessionIdsDescr()" class="badge">
    {{ accessionIdsDescr() }}
     <button type="button"
	     class="btn btn-xs btn-default"
	    ng-click="model.accessionIds = ''; onOK();">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
     </button>
  </span>
  
  <span ng-if="model.geoJson.params.taxonQuery" class="badge">
    {{ model.geoJson.params.taxonQuery }}
    <button type="button" class="btn btn-xs btn-default"
	    ng-click="model.taxonQuery = ''; model.traitOverlay = ''; onOK();">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
  </span>
  
  <span ng-if="model.geoJson.params.traitOverlay" class="badge">
    {{ model.geoJson.params.traitOverlay }}
    <button type="button" class="btn btn-xs btn-default"
	    ng-click="model.traitOverlay = ''; model.traitExcludeUnchar = false; onOK();">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
  </span>

  <span ng-if="model.geoJson.params.limitToMapExtent"
	class="badge">
    limit search to current map extent
    <button type="button"
	    class="btn btn-xs btn-default"
	    ng-click="model.limitToMapExtent = false ; onOK(); ">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
  </span>
  
  <span ng-if="model.geoJson.params.maxRecs" class="badge">
    max results: {{ model.geoJson.params.maxRecs | number }}
    <button class="btn btn-xs btn-default"
	    ng-click="onRemoveMaxResults()">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
  </span>
  
  <span ng-if="model.geoJson.params.country" class="badge">
    country: {{ model.geoJson.params.country }}
    <button class="btn btn-xs btn-default"
	    ng-click="model.country = null; onOK();">
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </button>
  </span>
</span>
</div>

<div class="panel panel-info"
     style="margin-top: 0.5rem;"
     ng-if="model.searchOptions">
  <div class="panel-heading">

    <button type="button" class="close" ng-click="model.searchOptions = false">
      <span aria-hidden="true">&times;</span>
    </button>
    
    <span class="glyphicon glyphicon-search"></span>
    Search parameters:
  </div>
  <div class="panel-body">
    
    <div class="alert alert-success" ng-if="model.alert">
      {{model.alert}}
    </div>

    <table class="table" style="margin-top: 0.5rem;">
      <tr>
	<td>
	  <span ng-if="model.taxonQuery"
		class="glyphicon glyphicon-asterisk" aria-hidden="true"></span>
	  
	  Search Taxon:
	  <button type="button"
		  ng-click="onExampleTaxonQuery()"
		  class="btn btn-xs btn-default">
	    <span class="glyphicon glyphicon-question-sign"
		  aria-hidden="true"></span>
	    Example
	  </button>
	</td>
	<td>
	  <form class="form-inline" ng-submit="onOK()">
	    <input id="taxon-filter"
		   type="text"
		   class="form-control"
		   ng-attr-auto-focus="! model.autofocusField || model.autofocusField === 'taxonFilter'"
		   size="40"
		   maxlength="256"
		   ng-change="onTaxonQuery(model.taxonQuery)"
		   ng-model="model.taxonQuery">
	    </input>
	    <button type="submit" class="btn btn-sm btn-default">
	      <span class="glyphicon glyphicon-search"
		    aria-hidden="true"></span>
	      Go
	    </button>
	    <button type="button"
		    ng-click="model.taxonQuery = null; model.traitOverlay = null;"
		    class="btn btn-sm btn-default">
	      <span class="glyphicon glyphicon-remove"
		    aria-hidden="true"></span>
	      Clear
	    </button>
	  </form>
	</td>
      </tr>
      
      <tr>
	<td style="white-space: nowrap;">
	  <span ng-if="model.traitOverlay"
		class="glyphicon glyphicon-asterisk" aria-hidden="true"></span>
	  Overlay Characterization and Evaluation
	  <button type="button"
		  ng-click="onTraitOverlayExample()"
		  class="btn btn-xs btn-default">
	    <span class="glyphicon glyphicon-question-sign"
		  aria-hidden="true"></span>
	    Example
	  </button>
	</td>
	<td>
	  <form class="form-inline" ng-submit="onOK()">
	    <div class="form-group">
	      <select class="form-control"
		      ng-disabled="! model.taxonQuery"
		      ng-model="model.traitOverlay">
		<option value="" ng-if="model.taxonQuery">
		  Select trait for {{model.taxonQuery}}
		  ({{model.traitDescriptors.length | number }})
		</option>
		<option value="" ng-if="! model.taxonQuery">
		  No taxon selected
		</option>
		<option ng-repeat="name in model.traitDescriptors"
			value="{{name}}">
		  {{name}}
		</option>
	      </select>
	      <button type="submit" class="btn btn-sm btn-default"
		      ng-disabled="! model.taxonQuery">
		<span class="glyphicon glyphicon-search"
		      aria-hidden="true"></span>
		Go
	      </button>
	      <button type="button"
		      ng-click="model.traitOverlay = null; model.traitExcludeUnchar = false;"
		      class="btn btn-sm btn-default">
		<span class="glyphicon glyphicon-remove"
		      aria-hidden="true"></span>
		Clear
	      </button>
	      <button type="button"
		      ng-disabled="! model.traitOverlay"
		      ng-click="onTraitOverlayOptions()"
		      class="btn btn-sm btn-default">
		<span class="glyphicon glyphicon-picture"
		      aria-hidden="true"></span>
		Display Options
	      </button>
	    </div>
	  </form>
	</td>
      </tr>
      <tr>
	<td>
	  <span ng-if="model.accessionIds"
	      class="glyphicon glyphicon-asterisk" aria-hidden="true"></span>
	  Search Accession IDs:
	  <button type="button"
		  ng-click="onExampleAccessions()"
		  class="btn btn-xs btn-default">
	    <span class="glyphicon glyphicon-question-sign"
		  aria-hidden="true"></span>
	    Example
	  </button>
	</td>
	<td>
	  <form class="form-inline"
		ng-submit="onOK()">
	    <input id="accession-ids-filter"
		   type="text"
		   class="form-control"
		   ng-attr-auto-focus="! model.autofocusField || model.autofocusField === 'accessionIdsFilter'"
		   size="40"
		   ng-model="model.accessionIds">
	    </input>
	    <button type="submit" class="btn btn-sm btn-default">
	      <span class="glyphicon glyphicon-search"
		    aria-hidden="true"></span>
	      Go
	    </button>
	    <button type="button"
		    ng-click="model.accessionIds = null;"
		    class="btn btn-sm btn-default">
	      <span class="glyphicon glyphicon-remove"
		    aria-hidden="true"></span>
	      Clear
	    </button>
	    <button type="button"
		      ng-disabled="! model.accessionIds"
		      ng-click="onAccessionIdOptions()"
		      class="btn btn-sm btn-default">
		<span class="glyphicon glyphicon-picture"
		      aria-hidden="true"></span>
		Display Options
	      </button>
	  </form>
	</td>
      </tr>
      <tr>
	<td>
	  <span ng-if="model.country"
		class="glyphicon glyphicon-asterisk" aria-hidden="true"></span>
	  Search Country:</td>
	<td>
	  <form class="form-inline"
		ng-submit="onOK()">
	    <label>
	      Limit to accessions in:
	    </label>
	    <select class="form-control"
		    ng-model="model.country"
		    ng-change="onCountry(model.country)">
	      <option value="">Country</option>
	      
	      <option ng-repeat="country in model.countries"
		      value="{{country}}">
		{{country}}
	      </option>
	    </select>
	    <button type="submit" class="btn btn-sm btn-default">
	      <span class="glyphicon glyphicon-search"
		    aria-hidden="true"></span>
	      Go
	    </button>
	    <button type="button"
		    ng-click="model.country = null;"
		    class="btn btn-sm btn-default">
	      <span class="glyphicon glyphicon-remove"
		    aria-hidden="true"></span>
	      Clear
	    </button>
	  </form>
	</td>
      </tr>
      <tr>
	<td>
	  <span ng-if="model.maxRecs"
		class="glyphicon glyphicon-asterisk" aria-hidden="true"></span>
	  Limit Search Results #:
	</td>
	<td>
	  <form class="form-inline"
		ng-submit="onOK()">
	    <label>
	      Limit # to:
	    </label>
	    <input type="text"
		   class="form-control"
		   ng-model="model.maxRecs"
		   ng-attr-auto-focus="! model.autofocusField || model.autofocusField === 'maxRecs'"
		   size="5">
	    </input>
	    <button type="submit" class="btn btn-sm btn-default">
	      <span class="glyphicon glyphicon-search"
		    aria-hidden="true"></span>
	      Go
	    </button>
	    Hint: increase for wider search area; decrease for speed.
	  </form>
	</td>
      </tr>
      <tr>
	<td>
	  <span ng-if="model.limitToMapExtent"
		class="glyphicon glyphicon-asterisk" aria-hidden="true"></span>
	  Search Extent:</td>
	<td>
	  <div class="checkbox">
	    <label>
	      <input type="checkbox"
		     ng-model="model.limitToMapExtent">
	      </input>
	      Limit to current map extent
	    </label>
	  </div>
	</td>
      </tr>
      <tr>
	<td colspan="2">
	  <button type="button"
		  class="btn btn-success" ng-click="onOK()">
	    <span class="glyphicon glyphicon-ok"
		  aria-hidden="true"></span>
	    
	    OK
	  </button>
	  <button type="button"
		  class="btn btn-default"
		  ng-click="model.searchOptions = false">
	    <span class="glyphicon glyphicon-remove"
		  aria-hidden="true"></span>
	    Cancel
	  </button>
	</td>
      </tr>
    </table>
  </div>
</div>

<script type="text/ng-template"
	id="trait-overlay-options.html">
  <div class="modal-header">
    <button type="button" class="close"
	    ng-click="onOK()">
      <span aria-hidden="true">&times;</span>
    </button>
    <h3 class="modal-title">
      <span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
      Display Options for {{ model.traitOverlay }}
    </h3>
  </div>
  <div class="modal-body">
    <div class="form-group">
      <div class="well well-sm">
	Uncharacterized Accessions:
	<div class="checkbox">
	  <label>
	    <input type="checkbox"
		   ng-model="model.traitExcludeUnchar"/>
	    Hide {{ model.traitOverlay }}
	    uncharacterized accessions from map frame.
	  </label>
	</div>
	(This option may reduce clutter on the map, if some accessions
	are missing observations for this trait. Uncharacterized
	accessions will still appear in the results table.)
      </div>
      <div class="well well-sm">
	Numeric ranges:
	
	If {{model.traitOverlay}} is a numeric trait, symbolize
	observations with the range of:
	<div class="radio">
	  <label>
	    <input type="radio"
		   ng-model="model.traitScale"
		   value="local">
	    Local values (observations from search results only)
	  </label>
	  <br/>
	  <label>
	    <input type="radio"
		   ng-model="model.traitScale"
		   value="global"/>
	    Global values (all observations for the selected taxon)
	  </label>
	</div>
      </div>
    </div>
    <button type="button"
	    class="btn btn-success" type="button"
	    ng-click="onOK()">
      <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
      OK
    </button>
    <button type="button"
	    class="btn btn-default"
	    ng-click="onCancel()">
      <span class="glyphicon glyphicon-remove"
	    aria-hidden="true"></span>
      Cancel
    </button>
  </div>
</script>

<script type="text/ng-template"
	id="accession-search-options.html">
  <div class="modal-header">
    <button type="button" class="close"
	    ng-click="onOK()">
      <span aria-hidden="true">&times;</span>
    </button>
    <h3 class="modal-title">
      <span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
      Display Options for Accession IDs
    </h3>
  </div>
  <div class="modal-body">

    <div class="form-group">
      Your set of accession numbers (please enter as comma separated list):
      <textarea class="form-control"
		ng-model="model.accessionIds">{{model.accessionIds}}
      </textarea>
    </div>
    <div class="form-group">
      <div class="well well-sm">
	Display of other accession IDs:
	<div class="radio">
	  <label>
	    <input type="radio"
		   ng-model="model.accessionIdsInclusive"
		   ng-value="false">
	    Show only these accession IDs on the map.
	  </label>
	  <br/>
	  <label>
	    <input type="radio"
		   ng-model="model.accessionIdsInclusive"
		   ng-value="true">
	   Show other search results, in addition to these accession IDs.
	  </label>
	</div>
      </div>
    </div>
    <div class="form-group">
      <div class="well well-sm">
	Colorizing:

	  <div class="checkbox">
	    <label>
	      <input type="checkbox"
		     ng-model="model.useCustomColor"
		     ng-click="onShowColorSelection(model.useCustomColor)">
	      Display the selected accession ids with a specific color
	      <span ng-if="! model.useCustomColor">...</span>
	      <span ng-if="model.useCustomColor">:</span>
	    </label>
	  </div>
	  
	  <form class="form-inline"
		ng-show="model.useCustomColor">
	    <label>
	      <input type="text"
		     class="form-control"
		     size="10"
		     ng-model="model.accessionIdsColor"
		     ng-style="{'background-color' : model.accessionIdsColor}"/>
	      Enter a color code or select from below
	    </label>
	    <br/>
	    <button type="button"
		    class="btn btn-sm"
		    ng-repeat="color in model.brewerColors"
		    ng-style="{'background-color': color}"
		    ng-click="model.accessionIdsColor = color">
	      &nbsp;
	    </button>
	</form>
      </div>
    </div>
    <button type="button"
	    class="btn btn-success" type="button"
	    ng-click="onOK()">
      <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
      OK
    </button>
    <button type="button"
	    class="btn btn-default"
	    ng-click="onCancel()">
      <span class="glyphicon glyphicon-remove"
	    aria-hidden="true"></span>
      Cancel
    </button>
  </div>
</script>
